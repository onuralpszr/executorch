


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>executorch.devtools.inspector._inspector &mdash; ExecuTorch 1.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../../_static/ExecuTorch-Logo-cropped.svg"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <!-- <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" /> -->
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/sg_gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/sg_gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/sg_gallery-dataframe.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/sg_gallery-rendered-html.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/progress-bar.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />


  <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-T8XT4PS');</script>
    <!-- End Google Tag Manager -->
  


  
  <script src="../../../../_static/js/modernizr.min.js"></script>

  <!-- Preload the theme fonts -->

<link rel="preload" href="../../../../_static/fonts/FreightSans/freight-sans-book.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../_static/fonts/FreightSans/freight-sans-medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../_static/fonts/IBMPlexMono/IBMPlexMono-Medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../_static/fonts/FreightSans/freight-sans-bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../_static/fonts/FreightSans/freight-sans-medium-italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../_static/fonts/IBMPlexMono/IBMPlexMono-SemiBold.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<!-- Preload the katex fonts -->

<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Math-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size1-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size4-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size2-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size3-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Caligraphic-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css" integrity="sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu" crossorigin="anonymous">
</head>

<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>

      <div class="main-menu">
        <ul>

          <li class="main-menu-item">
          <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">
                Learn
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/get-started">
                  <span class=dropdown-title>Get Started</span>
                  <p>Run PyTorch locally or get started quickly with one of the supported cloud platforms</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/tutorials">
                  <span class="dropdown-title">Tutorials</span>
                  <p>Whats new in PyTorch tutorials</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/tutorials/beginner/basics/intro.html">
                  <span class="dropdown-title">Learn the Basics</span>
                  <p>Familiarize yourself with PyTorch concepts and modules</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/tutorials/recipes/recipes_index.html">
                  <span class="dropdown-title">PyTorch Recipes</span>
                  <p>Bite-size, ready-to-deploy PyTorch code examples</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/tutorials/beginner/introyt.html">
                  <span class="dropdown-title">Intro to PyTorch - YouTube Series</span>
                  <p>Master PyTorch basics with our engaging YouTube tutorial series</p>
                </a>
              </div>
            </div>
          </li>

          <li>
          <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">
                Ecosystem
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/ecosystem">
                  <span class="dropdown-title">Tools</span>
                  <p>Learn about the tools and frameworks in the PyTorch Ecosystem</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/#community-module">
                  <span class=dropdown-title>Community</span>
                  <p>Join the PyTorch developer community to contribute, learn, and get your questions answered</p>
                </a>
                <a class="nav-dropdown-item" href="https://discuss.pytorch.org/" target="_blank">
                  <span class=dropdown-title>Forums</span>
                  <p>A place to discuss PyTorch code, issues, install, research</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/resources">
                  <span class=dropdown-title>Developer Resources</span>
                  <p>Find resources and get questions answered</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/ecosystem/contributor-awards-2024">
                  <span class="dropdown-title">Contributor Awards - 2024</span>
                  <p>Award winners announced at this year's PyTorch Conference</p>
                </a>
              </div>
            </div>
          </li>

          <li>
          <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">
                Edge
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/edge">
                  <span class="dropdown-title">About PyTorch Edge</span>
                  <p>Build innovative and privacy-aware AI experiences for edge devices</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/executorch-overview">
                  <span class="dropdown-title">ExecuTorch</span>
                  <p>End-to-end solution for enabling on-device inference capabilities across mobile and edge devices</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/executorch/stable/index.html">
                  <span class="dropdown-title">ExecuTorch Docs</span>
                </a>
              </div>
            </div>  
          </li>

          <li class="main-menu-item">
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">
                Docs
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/docs/stable/index.html">
                  <span class="dropdown-title">PyTorch</span>
                  <p>Explore the documentation for comprehensive guidance on how to use PyTorch</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/pytorch-domains">
                  <span class="dropdown-title">PyTorch Domains</span>
                  <p>Read the PyTorch Domains documentation to learn more about domain-specific libraries</p>
                </a>
              </div>
            </div>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">
                Blogs & News 
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/blog/">
                  <span class="dropdown-title">PyTorch Blog</span>
                  <p>Catch up on the latest technical news and happenings</p>
                </a>
                 <a class="nav-dropdown-item" href="https://pytorch.org/community-blog">
                  <span class="dropdown-title">Community Blog</span>
                  <p>Stories from the PyTorch ecosystem</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/videos">
                  <span class="dropdown-title">Videos</span>
                  <p>Learn about the latest PyTorch tutorials, new, and more </p>
                <a class="nav-dropdown-item" href="https://pytorch.org/community-stories">
                  <span class="dropdown-title">Community Stories</span>
                  <p>Learn how our community solves real, everyday machine learning problems with PyTorch</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/events">
                  <span class="dropdown-title">Events</span>
                  <p>Find events, webinars, and podcasts</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/newsletter">
                  <span class="dropdown-title">Newsletter</span>
                  <p>Stay up-to-date with the latest updates</p>
                </a>
            </div>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">
                About
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/foundation">
                  <span class="dropdown-title">PyTorch Foundation</span>
                  <p>Learn more about the PyTorch Foundation</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/governing-board">
                  <span class="dropdown-title">Governing Board</span>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/credits">
                  <span class="dropdown-title">Cloud Credit Program</span>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/tac">
                  <span class="dropdown-title">Technical Advisory Council</span>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/staff">
                  <span class="dropdown-title">Staff</span>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/contact-us">
                  <span class="dropdown-title">Contact Us</span>
                </a>
              </div>
            </div>
          </li>

          <li class="main-menu-item">
            <div class="no-dropdown">
              <a href="https://pytorch.org/join" data-cta="join">
                Become a Member
              </a>
            </div>
          </li>
          <li>
           <div class="main-menu-item">
             <a href="https://github.com/pytorch/pytorch" class="github-icon">
             </a>
           </div>
          </li>
          <!--- TODO: This block adds the search icon to the nav bar. We will enable it later. 
          <li>
            <div class="main-menu-item">
             <a href="https://github.com/pytorch/pytorch" class="search-icon">
             </a>
            </div>
          </li>
          --->
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>
  </div>
</div>

<body class="pytorch-body">

   

    

    <div class="table-of-contents-link-wrapper">
      <span>Table of Contents</span>
      <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
    </div>

    <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
      <div class="pytorch-side-scroll">
        <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          <div class="pytorch-left-menu-search">
            
    <div class="version">
      <a href='https://pytorch.org/executorch/versions.html'>1.0 &#x25BC</a>
    </div>
    


  


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search Docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          </div>

          
    
         
         
         
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../intro-overview.html">ExecuTorch Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../intro-how-it-works.html">How ExecuTorch Works</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting-started-architecture.html">Architecture and Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts.html">Concepts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting-started.html">Getting Started with ExecuTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../using-executorch-export.html">Model Export and Lowering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../using-executorch-android.html">Using ExecuTorch on Android</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../using-executorch-ios.html">Using ExecuTorch on iOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../using-executorch-cpp.html">Using ExecuTorch with C++</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../using-executorch-runtime-integration.html">Runtime Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../using-executorch-troubleshooting.html">Profiling and Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../using-executorch-building-from-source.html">Building from Source</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../using-executorch-faqs.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/pytorch-labs/executorch-examples/tree/main/dl3/android/DeepLabV3Demo#executorch-android-demo-app">Building an ExecuTorch Android Demo App</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/meta-pytorch/executorch-examples/tree/main/mv3/apple/ExecuTorchDemo">Building an ExecuTorch iOS Demo App</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial-arm-ethos-u.html">Arm Ethos-U NPU Backend Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial-arm-vgf.html">Arm VGF Backend Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Backends</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../backends-overview.html">Backend Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../backends-xnnpack.html">XNNPACK Backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../backends-coreml.html">Core ML Backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../backends-mps.html">MPS Backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../backends-vulkan.html">Vulkan Backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../backends-arm-ethos-u.html">Arm® Ethos™-U NPU Backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../backends-arm-vgf.html">Arm® VGF Backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../backends-qualcomm.html">Qualcomm AI Engine Backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../backends-mediatek.html">MediaTek Backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../backends-cadence.html">Cadence Xtensa Backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../build-run-openvino.html">OpenVINO Backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../backends-nxp.html">NXP eIQ Neutron Backend</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../devtools-overview.html">Introduction to the ExecuTorch Developer Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../bundled-io.html">Bundled Program – a Tool for ExecuTorch Model Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../etrecord.html">Prerequisite | ETRecord - ExecuTorch Record</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../etdump.html">Prerequisite | ETDump - ExecuTorch Dump</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../runtime-profiling.html">Profiling Models in ExecuTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../model-debugging.html">Debugging Models in ExecuTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../model-inspector.html">Inspector APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory-planning-inspection.html">Memory Planning Inspection in ExecuTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../delegate-debugging.html">Delegate Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../devtools-tutorial.html">Developer Tools Usage Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Runtime</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../runtime-overview.html">ExecuTorch Runtime Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../extension-module.html">Running an ExecuTorch Model Using the Module Extension in C++</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../extension-tensor.html">Managing Tensor Memory in C++</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../running-a-model-cpp-tutorial.html">Detailed C++ Runtime APIs Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../runtime-backend-delegate-implementation-and-linking.html">Backend Delegate Implementation and Linking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../runtime-platform-abstraction-layer.html">Runtime Platform Abstraction Layer (PAL)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../portable-cpp-programming.html">Portable C++ Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pte-file-format.html"><code class="docutils literal notranslate"><span class="pre">.pte</span></code> file format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ptd-file-format.html"><code class="docutils literal notranslate"><span class="pre">.ptd</span></code> file format</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../export-to-executorch-api-reference.html">Export API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../executorch-runtime-api-reference.html">Runtime API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../runtime-python-api-reference.html">Runtime Python API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api-life-cycle.html">API Life Cycle and Deprecation Policy</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/executorch/main/javadoc/">Javadoc</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quantization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../quantization-overview.html">Quantization Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../quantization-overview.html#quantization-in-executorch">Quantization in ExecuTorch</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Kernel Library</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../kernel-library-overview.html">Overview of ExecuTorch’s Kernel Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../kernel-library-custom-aten-kernel.html">Kernel Registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../kernel-library-selective-build.html">Kernel Library Selective Build</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Working with LLMs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../llm/getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../llm/export-llm.html">Exporting LLMs with export_llm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../llm/export-custom-llm.html">Exporting custom LLMs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../llm/run-with-c-plus-plus.html">Running with C++</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../llm/llama-demo-android.html">Running on Android &lt;XNNPack&gt;</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../llm/build-run-llama3-qualcomm-ai-engine-direct-backend.html">Running on Android &lt;QNN&gt;</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../llm/run-on-ios.html">Running on iOS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Backend Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../backend-delegates-integration.html">Integrating a Backend Delegate into ExecuTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../backend-delegates-xnnpack-reference.html">XNNPACK Delegate Internals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../backend-delegates-dependencies.html">Third-Party Dependency Management for Backend Delegates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../compiler-delegate-and-partitioner.html">Backends and Delegates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../debug-backend-delegate.html">Debugging Delegation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">IR Specification</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../ir-exir.html">Export IR Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ir-ops-set-definition.html">Definition of the Core ATen Operator Set</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Compiler Entry Points</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../compiler-backend-dialect.html">Backend Dialect</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../compiler-custom-compiler-passes.html">Custom Compiler Passes and Partitioners</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../compiler-memory-planning.html">Memory Planning</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributing.html">Contributing to ExecuTorch</a></li>
</ul>

         

        </div>
      </div>
    </nav>

    <div class="pytorch-container">
      <div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
        <div class="pytorch-breadcrumbs-wrapper">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="pytorch-breadcrumbs">
    
      <li>
        <a href="../../../../index.html">
          
            Docs
          
        </a> &gt;
      </li>

        
          <li><a href="../../../index.html">Module code</a> &gt;</li>
        
      <li>executorch.devtools.inspector._inspector</li>
    
    
      <li class="pytorch-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
</div>
        </div>

        <div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">
          Shortcuts
        </div>
      </div>

      <section data-toggle="wy-nav-shift" id="pytorch-content-wrap" class="pytorch-content-wrap">
        <div class="pytorch-content-left">

        


          <!-- Google Tag Manager (noscript) -->
          <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T8XT4PS"
          height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
          <!-- End Google Tag Manager (noscript) -->
          
          <div class="rst-content">
          
            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
             <article itemprop="articleBody" id="pytorch-article" class="pytorch-article">
              
  <h1>Source code for executorch.devtools.inspector._inspector</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (c) Meta Platforms, Inc. and affiliates.</span>
<span class="c1"># All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># This source code is licensed under the BSD-style license found in the</span>
<span class="c1"># LICENSE file in the root directory of this source tree.</span>

<span class="c1"># pyre-unsafe</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">dataclasses</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span><span class="p">,</span> <span class="n">OrderedDict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">cached_property</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">Any</span><span class="p">,</span>
    <span class="n">Callable</span><span class="p">,</span>
    <span class="n">Dict</span><span class="p">,</span>
    <span class="n">IO</span><span class="p">,</span>
    <span class="n">List</span><span class="p">,</span>
    <span class="n">Mapping</span><span class="p">,</span>
    <span class="n">Optional</span><span class="p">,</span>
    <span class="n">Sequence</span><span class="p">,</span>
    <span class="n">Tuple</span><span class="p">,</span>
    <span class="n">TypeAlias</span><span class="p">,</span>
    <span class="n">TypedDict</span><span class="p">,</span>
    <span class="n">Union</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">executorch.devtools.etdump.schema_flatcc</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">flatcc</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">executorch.devtools.debug_format.et_schema</span><span class="w"> </span><span class="kn">import</span> <span class="n">OperatorGraph</span><span class="p">,</span> <span class="n">OperatorNode</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">executorch.devtools.etdump.schema_flatcc</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">DebugEvent</span><span class="p">,</span>
    <span class="n">ETDumpFlatCC</span><span class="p">,</span>
    <span class="n">ProfileEvent</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">executorch.devtools.etrecord</span><span class="w"> </span><span class="kn">import</span> <span class="n">ETRecord</span><span class="p">,</span> <span class="n">parse_etrecord</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">executorch.devtools.inspector._inspector_utils</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">calculate_time_scale_factor</span><span class="p">,</span>
    <span class="n">compare_intermediate_outputs</span><span class="p">,</span>
    <span class="n">create_debug_handle_to_op_node_mapping</span><span class="p">,</span>
    <span class="n">DebugHandle</span><span class="p">,</span>
    <span class="n">display_or_print_df</span><span class="p">,</span>
    <span class="n">EDGE_DIALECT_GRAPH_KEY</span><span class="p">,</span>
    <span class="n">EXCLUDED_COLUMNS_WHEN_PRINTING</span><span class="p">,</span>
    <span class="n">EXCLUDED_EVENTS_FOR_INTERMEDIATE_OUTPUT</span><span class="p">,</span>
    <span class="n">EXCLUDED_EVENTS_WHEN_PRINTING</span><span class="p">,</span>
    <span class="n">find_op_names</span><span class="p">,</span>
    <span class="n">find_populated_event</span><span class="p">,</span>
    <span class="n">FORWARD</span><span class="p">,</span>
    <span class="n">gen_etdump_object</span><span class="p">,</span>
    <span class="n">gen_graphs_from_etrecord</span><span class="p">,</span>
    <span class="n">get_aot_debug_handle_to_op_name_mapping</span><span class="p">,</span>
    <span class="n">inflate_runtime_output</span><span class="p">,</span>
    <span class="n">is_debug_output</span><span class="p">,</span>
    <span class="n">is_inference_output_equal</span><span class="p">,</span>
    <span class="n">map_runtime_aot_intermediate_outputs</span><span class="p">,</span>
    <span class="n">merge_runtime_overlapping_debug_handles</span><span class="p">,</span>
    <span class="n">ProgramOutput</span><span class="p">,</span>
    <span class="n">propagate_back_debug_handle</span><span class="p">,</span>
    <span class="n">RESERVED_FRAMEWORK_EVENT_NAMES</span><span class="p">,</span>
    <span class="n">TimeScale</span><span class="p">,</span>
    <span class="n">verify_debug_data_equivalence</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">executorch.devtools.inspector._intermediate_output_capturer</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">IntermediateOutputCapturer</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">executorch.devtools.inspector.numerical_comparator</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">L1Comparator</span><span class="p">,</span>
    <span class="n">MSEComparator</span><span class="p">,</span>
    <span class="n">SNRComparator</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">executorch.exir</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExportedProgram</span>


<span class="n">log</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="c1"># Signature of an InstructionEvent</span>
<span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">InstructionEventSignature</span><span class="p">:</span>
    <span class="n">instruction_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">chain_index</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">delegate_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">delegate_id_str</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>


<span class="c1"># Aggregated Runtime Events for a single instruction</span>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">InstructionEvent</span><span class="p">:</span>
    <span class="n">signature</span><span class="p">:</span> <span class="n">InstructionEventSignature</span>
    <span class="n">profile_events</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">ProfileEvent</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">debug_events</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">DebugEvent</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">gen_from_events</span><span class="p">(</span><span class="n">run_events</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">flatcc</span><span class="o">.</span><span class="n">Event</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;InstructionEvent&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a list of events from a run in ETDump, collate the ProfileEvent</span>
<span class="sd">        and DebugEvents by instruction id and return a list of InstructionEvents</span>
<span class="sd">        constructed from collated events (ignoring run_output events)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">instruction_events</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">InstructionEventSignature</span><span class="p">,</span> <span class="n">InstructionEvent</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">run_events</span><span class="p">:</span>
            <span class="c1"># Find the event that was logged</span>
            <span class="n">populated_event</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">DebugEvent</span><span class="p">,</span> <span class="n">ProfileEvent</span><span class="p">]</span> <span class="o">=</span> <span class="n">find_populated_event</span><span class="p">(</span>
                <span class="n">event</span>
            <span class="p">)</span>

            <span class="c1"># Get existing InstructionEvent or insert a new one</span>
            <span class="n">signature</span> <span class="o">=</span> <span class="n">InstructionEventSignature</span><span class="p">(</span>
                <span class="n">instruction_id</span><span class="o">=</span><span class="n">populated_event</span><span class="o">.</span><span class="n">instruction_id</span><span class="p">,</span>
                <span class="n">chain_index</span><span class="o">=</span><span class="n">populated_event</span><span class="o">.</span><span class="n">chain_index</span><span class="p">,</span>
                <span class="n">delegate_id</span><span class="o">=</span><span class="n">populated_event</span><span class="o">.</span><span class="n">delegate_debug_id_int</span><span class="p">,</span>
                <span class="n">delegate_id_str</span><span class="o">=</span><span class="n">populated_event</span><span class="o">.</span><span class="n">delegate_debug_id_str</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">instruction_event</span> <span class="o">=</span> <span class="n">instruction_events</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span>
                <span class="n">signature</span><span class="p">,</span> <span class="n">InstructionEvent</span><span class="p">(</span><span class="n">signature</span><span class="o">=</span><span class="n">signature</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># Update InstructionEvent based on event type</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">populated_event</span><span class="p">,</span> <span class="n">ProfileEvent</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">instruction_event</span><span class="o">.</span><span class="n">profile_events</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">instruction_event</span><span class="o">.</span><span class="n">profile_events</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">instruction_event</span><span class="o">.</span><span class="n">profile_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">populated_event</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">populated_event</span><span class="p">,</span> <span class="n">DebugEvent</span><span class="p">):</span>
                <span class="c1"># Ignore run_output events</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">is_debug_output</span><span class="p">(</span><span class="n">populated_event</span><span class="o">.</span><span class="n">debug_entry</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">instruction_event</span><span class="o">.</span><span class="n">debug_events</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">instruction_event</span><span class="o">.</span><span class="n">debug_events</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">instruction_event</span><span class="o">.</span><span class="n">debug_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">populated_event</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">instruction_events</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>


<span class="c1"># Signature of a ProfileEvent</span>
<span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ProfileEventSignature</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">instruction_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="n">delegate_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">delegate_id_str</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_gen_from_event</span><span class="p">(</span><span class="n">event</span><span class="p">:</span> <span class="n">ProfileEvent</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ProfileEventSignature&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a ProfileEvent, extract the fields into a signature</span>

<span class="sd">        ProfileEvents from ETDump default to &quot;&quot; and -1 when the field is not populated</span>
<span class="sd">        The Signature will convert these back to the intended None value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ProfileEventSignature</span><span class="p">(</span>
            <span class="n">event</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">event</span><span class="o">.</span><span class="n">instruction_id</span> <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">instruction_id</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">event</span><span class="o">.</span><span class="n">delegate_debug_id_int</span> <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">delegate_debug_id_int</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">event</span><span class="o">.</span><span class="n">delegate_debug_id_str</span> <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">delegate_debug_id_str</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>


<span class="c1"># Signature of a DebugEvent</span>
<span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DebugEventSignature</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">instruction_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">delegate_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">delegate_id_str</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_gen_from_event</span><span class="p">(</span><span class="n">event</span><span class="p">:</span> <span class="n">DebugEvent</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;DebugEventSignature&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a DebugEvent, extract the fields into a signature</span>

<span class="sd">        DebugEvents from ETDump default to &quot;&quot; and -1 when the field is not populated</span>
<span class="sd">        The Signature will convert these back to the intended None value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">DebugEventSignature</span><span class="p">(</span>
            <span class="n">event</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">event</span><span class="o">.</span><span class="n">instruction_id</span> <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">instruction_id</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">event</span><span class="o">.</span><span class="n">delegate_debug_id_int</span> <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">delegate_debug_id_int</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">event</span><span class="o">.</span><span class="n">delegate_debug_id_str</span> <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">delegate_debug_id_str</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>


<span class="c1"># Signature of an Event inside of a Run</span>
<span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">EventSignature</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Note that (profile_event_signature, debug_event_signature) are sufficient</span>
<span class="sd">    signature identifiers.</span>

<span class="sd">    instruction_id is extracted from the signatures (equivalent in both) and</span>
<span class="sd">    surfaced for convenience</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">instruction_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">profile_event_signature</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ProfileEventSignature</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">debug_event_signature</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DebugEventSignature</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">gen_from_instruction_event</span><span class="p">(</span>
        <span class="n">instruction_event</span><span class="p">:</span> <span class="n">InstructionEvent</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="s2">&quot;EventSignature&quot;</span><span class="p">,</span> <span class="n">InstructionEvent</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct EventSignatures from the given InstructionEvent</span>
<span class="sd">        and return tuples of (1) EventSignature and (2) related subset</span>
<span class="sd">        InstructionEvent</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Generate the DebugEventSignature</span>
        <span class="n">debug_events</span> <span class="o">=</span> <span class="n">instruction_event</span><span class="o">.</span><span class="n">debug_events</span>
        <span class="n">debug_signature</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">DebugEventSignature</span><span class="o">.</span><span class="n">_gen_from_event</span><span class="p">(</span><span class="n">debug_events</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">debug_events</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">debug_events</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>

        <span class="c1"># If no ProfileEvents, return a singleton EventSignature</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">profile_events</span> <span class="o">:=</span> <span class="n">instruction_event</span><span class="o">.</span><span class="n">profile_events</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="p">(</span>
                    <span class="n">EventSignature</span><span class="p">(</span>
                        <span class="n">instruction_id</span><span class="o">=</span><span class="n">instruction_event</span><span class="o">.</span><span class="n">signature</span><span class="o">.</span><span class="n">instruction_id</span><span class="p">,</span>
                        <span class="n">debug_event_signature</span><span class="o">=</span><span class="n">debug_signature</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">instruction_event</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">]</span>

        <span class="c1"># Generate the ProfileEventSignature</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="p">(</span>
                <span class="n">EventSignature</span><span class="p">(</span>
                    <span class="n">instruction_id</span><span class="o">=</span><span class="n">instruction_event</span><span class="o">.</span><span class="n">signature</span><span class="o">.</span><span class="n">instruction_id</span><span class="p">,</span>
                    <span class="n">profile_event_signature</span><span class="o">=</span><span class="n">ProfileEventSignature</span><span class="o">.</span><span class="n">_gen_from_event</span><span class="p">(</span>
                        <span class="n">profile_event</span>
                    <span class="p">),</span>
                    <span class="n">debug_event_signature</span><span class="o">=</span><span class="n">debug_signature</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">dataclasses</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">instruction_event</span><span class="p">,</span> <span class="n">profile_events</span><span class="o">=</span><span class="p">[</span><span class="n">profile_event</span><span class="p">]),</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">profile_event</span> <span class="ow">in</span> <span class="n">profile_events</span>
        <span class="p">]</span>


<span class="c1"># Signature of a Run</span>
<span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RunSignature</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        name: Name of the run</span>
<span class="sd">        events: List of EventSignatures that correspond to the run</span>
<span class="sd">        bundled_input_index: Index of the bundled input used to generate the debug output</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">events</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">EventSignature</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">bundled_input_index</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>


<span class="c1"># Typing for mapping Event.delegate_debug_identifiers to debug_handle(s)</span>
<span class="n">DelegateIdentifierDebugHandleMap</span><span class="p">:</span> <span class="n">TypeAlias</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">Mapping</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">DebugHandle</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DebugHandle</span><span class="p">]</span>
<span class="p">]</span>

<span class="c1"># Typing for Dict containig delegate metadata</span>
<span class="n">DelegateMetadata</span> <span class="o">=</span> <span class="n">TypedDict</span><span class="p">(</span>
    <span class="s2">&quot;DelegateMetadata&quot;</span><span class="p">,</span>
    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;delegate_map&quot;</span><span class="p">:</span> <span class="n">DelegateIdentifierDebugHandleMap</span><span class="p">},</span>
<span class="p">)</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PerfData</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">p10</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">p50</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">p90</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">avg</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw</span><span class="p">)</span>


<div class="viewcode-block" id="Event"><a class="viewcode-back" href="../../../../model-inspector.html#executorch.devtools.inspector.Event">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Event</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An Event corresponds to an operator instance with perf data retrieved from the runtime and other metadata from `ETRecord`.</span>

<span class="sd">    Args:</span>
<span class="sd">        name: Name of the profiling `Event`, empty if no profiling event.</span>
<span class="sd">        perf_data: Performance data associated with the event retrived from the runtime (available attributes: p10, p50, p90, avg, min and max).</span>
<span class="sd">        op_type: List of op types corresponding to the event.</span>
<span class="sd">        delegate_debug_identifier: Supplemental identifier used in combination with instruction id.</span>
<span class="sd">        debug_handles: Debug handles in the model graph to which this event is correlated.</span>
<span class="sd">        num_outputs: Indicates the number of outputs generated by the node.</span>
<span class="sd">                     Right now only used for call_delegate nodes that output more than one tensor.</span>
<span class="sd">        stack_trace: A dictionary mapping the name of each associated op to its stack trace.</span>
<span class="sd">        module_hierarchy: A dictionary mapping the name of each associated op to its module hierarchy.</span>
<span class="sd">        is_delegated_op: Whether or not the event was delegated.</span>
<span class="sd">        delegate_backend_name: Name of the backend this event was delegated to.</span>

<span class="sd">        _delegate_debug_metadatas: A list of raw delegate debug metadata in string, one for each profile event.</span>
<span class="sd">            Available parsed (if parser provided) as Event.delegate_debug_metadatas</span>
<span class="sd">            Available as Event.raw_delegate_debug_metadatas</span>

<span class="sd">        debug_data: A list containing intermediate data collected.</span>

<span class="sd">        _instruction_id: Instruction Identifier for Symbolication</span>
<span class="sd">        _delegate_metadata_parser: Optional Parser for _delegate_debug_metadatas</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">perf_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PerfData</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">op_types</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">delegate_debug_identifier</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">debug_handles</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">num_outputs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">stack_traces</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">module_hierarchy</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">is_delegated_op</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">delegate_backend_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_delegate_debug_metadatas</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

    <span class="n">debug_data</span><span class="p">:</span> <span class="n">ProgramOutput</span> <span class="o">=</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">_instruction_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">_delegate_metadata_parser</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_delegate_time_scale_converter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Callable</span><span class="p">[[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_start_time</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">delegate_debug_metadatas</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the parsed _delegate_debug_metadatas if a parser is available</span>
<span class="sd">        Otherwise returns the raw _delegate_debug_metadatas</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_delegated_op</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delegate_metadata_parser</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delegate_debug_metadatas</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delegate_metadata_parser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_delegate_debug_metadatas</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">raw_delegate_debug_metadatas</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the raw unparsed _delegate_debug_metadatas</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delegate_debug_metadatas</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">start_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the start time of the event.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start_time</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_units</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert the Event into a pandas DataFrame</span>

<span class="sd">        Args:</span>
<span class="sd">            None</span>

<span class="sd">        Returns:</span>
<span class="sd">            A pandas DataFrame with the Event data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">event_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">asdict</span><span class="p">(</span><span class="n">_units</span><span class="o">=</span><span class="n">_units</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">event_dict</span><span class="p">)</span>

    <span class="c1"># Override the default implementation of dataclass.asdict to handle null perf data</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">asdict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_units</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert the Event into a dict</span>

<span class="sd">        Args:</span>
<span class="sd">            None</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dict with the Event data</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">truncated_list</span><span class="p">(</span><span class="n">long_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;[&#39;</span><span class="si">{</span><span class="n">long_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;, &#39;</span><span class="si">{</span><span class="n">long_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; ... &#39;</span><span class="si">{</span><span class="n">long_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;] (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">long_list</span><span class="p">)</span><span class="si">}</span><span class="s2"> total)&quot;</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;event_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;raw&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">perf_data</span><span class="o">.</span><span class="n">raw</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">perf_data</span> <span class="k">else</span> <span class="kc">None</span><span class="p">],</span>
            <span class="s2">&quot;p10&quot;</span> <span class="o">+</span> <span class="n">_units</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">perf_data</span><span class="o">.</span><span class="n">p10</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">perf_data</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;p50&quot;</span> <span class="o">+</span> <span class="n">_units</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">perf_data</span><span class="o">.</span><span class="n">p50</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">perf_data</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;p90&quot;</span> <span class="o">+</span> <span class="n">_units</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">perf_data</span><span class="o">.</span><span class="n">p90</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">perf_data</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;avg&quot;</span> <span class="o">+</span> <span class="n">_units</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">perf_data</span><span class="o">.</span><span class="n">avg</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">perf_data</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;min&quot;</span> <span class="o">+</span> <span class="n">_units</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">perf_data</span><span class="o">.</span><span class="n">min</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">perf_data</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;max&quot;</span> <span class="o">+</span> <span class="n">_units</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">perf_data</span><span class="o">.</span><span class="n">max</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">perf_data</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;op_types&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">op_types</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">op_types</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span>
                    <span class="k">else</span> <span class="n">truncated_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">op_types</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">],</span>
            <span class="s2">&quot;delegate_debug_identifier&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">delegate_debug_identifier</span><span class="p">,</span>
            <span class="s2">&quot;stack_traces&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stack_traces</span><span class="p">],</span>
            <span class="s2">&quot;module_hierarchy&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">module_hierarchy</span><span class="p">],</span>
            <span class="s2">&quot;is_delegated_op&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_delegated_op</span><span class="p">,</span>
            <span class="s2">&quot;delegate_backend_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">delegate_backend_name</span><span class="p">,</span>
            <span class="s2">&quot;debug_data&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">debug_data</span><span class="p">],</span>
            <span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_start_time</span><span class="p">],</span>
        <span class="p">}</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_gen_from_inference_events</span><span class="p">(</span>
        <span class="n">signature</span><span class="p">:</span> <span class="n">EventSignature</span><span class="p">,</span>
        <span class="n">events</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">InstructionEvent</span><span class="p">],</span>
        <span class="n">scale_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">output_buffer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">delegate_metadata_parser</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Callable</span><span class="p">[[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">delegate_time_scale_converter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Callable</span><span class="p">[[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Event&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given an EventSignature and a list of Events with that signature,</span>
<span class="sd">        return an Event object matching the EventSignature, with perf_data</span>
<span class="sd">        populated from the list of ProfileEvents and debug_data populated from</span>
<span class="sd">        the list of DebugEvents.</span>

<span class="sd">        An optional inverse scale factor can be provided to adjust the event timestamps</span>
<span class="sd">        An optional buffer can be provided to inflate etdump references</span>
<span class="sd">        An optional delegate_metadata_parser can be provided to parse the delegate metadata</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">profile_event_signature</span> <span class="o">=</span> <span class="n">signature</span><span class="o">.</span><span class="n">profile_event_signature</span>
        <span class="n">debug_event_signature</span> <span class="o">=</span> <span class="n">signature</span><span class="o">.</span><span class="n">debug_event_signature</span>

        <span class="c1"># Event is gradually populated in this function</span>
        <span class="n">ret_event</span><span class="p">:</span> <span class="n">Event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">_instruction_id</span><span class="o">=</span><span class="n">signature</span><span class="o">.</span><span class="n">instruction_id</span><span class="p">,</span>
            <span class="n">_delegate_metadata_parser</span><span class="o">=</span><span class="n">delegate_metadata_parser</span><span class="p">,</span>
            <span class="n">_delegate_time_scale_converter</span><span class="o">=</span><span class="n">delegate_time_scale_converter</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Populate fields from profile events</span>
        <span class="n">Event</span><span class="o">.</span><span class="n">_populate_profiling_related_fields</span><span class="p">(</span>
            <span class="n">ret_event</span><span class="p">,</span> <span class="n">profile_event_signature</span><span class="p">,</span> <span class="n">events</span><span class="p">,</span> <span class="n">scale_factor</span>
        <span class="p">)</span>

        <span class="c1"># Populate fields from debug events</span>
        <span class="n">Event</span><span class="o">.</span><span class="n">_populate_debugging_related_fields</span><span class="p">(</span>
            <span class="n">ret_event</span><span class="p">,</span> <span class="n">debug_event_signature</span><span class="p">,</span> <span class="n">events</span><span class="p">,</span> <span class="n">output_buffer</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">ret_event</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_elapsed_time</span><span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">):</span>
        <span class="c1"># We&#39;re assuming if there&#39;s a wraparound in the time values, then</span>
        <span class="c1"># the time representation of that platform only contains 32 bits.</span>
        <span class="c1"># This should be fine for now, but ideally we should source the max</span>
        <span class="c1"># time value from the platform using etdump.</span>
        <span class="n">max_uint32</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">32</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">start_time</span> <span class="o">&gt;</span> <span class="n">end_time</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">start_time</span> <span class="o">&gt;</span> <span class="n">max_uint32</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">end_time</span> <span class="o">&gt;</span> <span class="n">max_uint32</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Expected start_time (</span><span class="si">{</span><span class="n">start_time</span><span class="si">}</span><span class="s2">) and end_time (</span><span class="si">{</span><span class="n">end_time</span><span class="si">}</span><span class="s2">) to be less than </span><span class="si">{</span><span class="n">max_uint32</span><span class="si">}</span><span class="s2"> for cases where there is wrap-around of time values.&quot;</span>
                <span class="p">)</span>
            <span class="c1"># Handle wraparound</span>
            <span class="n">elapsed_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_uint32</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">+</span> <span class="n">end_time</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Normal case</span>
            <span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="k">return</span> <span class="n">elapsed_time</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_populate_event_signature_fields</span><span class="p">(</span>
        <span class="n">ret_event</span><span class="p">:</span> <span class="s2">&quot;Event&quot;</span><span class="p">,</span>
        <span class="n">event_signature</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">ProfileEventSignature</span><span class="p">,</span> <span class="n">DebugEventSignature</span><span class="p">]],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a partially constructed Event, populate the fields related to</span>
<span class="sd">        the profile event signature or debug event signature</span>

<span class="sd">        Fields Updated:</span>
<span class="sd">            name</span>
<span class="sd">            delegate_debug_identifier</span>
<span class="sd">            is_delegated_op</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: T201347372 Push the None check to ealier in the stack.</span>
        <span class="k">if</span> <span class="n">event_signature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">event_signature</span><span class="o">.</span><span class="n">delegate_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># 0 is a valid value</span>
                <span class="n">delegate_debug_identifier</span> <span class="o">=</span> <span class="n">event_signature</span><span class="o">.</span><span class="n">delegate_id</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">delegate_debug_identifier</span> <span class="o">=</span> <span class="n">event_signature</span><span class="o">.</span><span class="n">delegate_id_str</span> <span class="ow">or</span> <span class="kc">None</span>

            <span class="c1"># Use the delegate identifier as the event name if delegated</span>
            <span class="n">is_delegated_op</span> <span class="o">=</span> <span class="n">delegate_debug_identifier</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="n">name</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">event_signature</span><span class="o">.</span><span class="n">name</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">is_delegated_op</span>
                <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">delegate_debug_identifier</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># Update fields</span>
            <span class="c1"># This is for older version of etdump that doesn&#39;t have the name field for debug events, we don&#39;t update the name field</span>
            <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
                <span class="n">ret_event</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
            <span class="n">ret_event</span><span class="o">.</span><span class="n">delegate_debug_identifier</span> <span class="o">=</span> <span class="n">delegate_debug_identifier</span>
            <span class="n">ret_event</span><span class="o">.</span><span class="n">is_delegated_op</span> <span class="o">=</span> <span class="n">is_delegated_op</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_populate_profiling_related_fields</span><span class="p">(</span>
        <span class="n">ret_event</span><span class="p">:</span> <span class="s2">&quot;Event&quot;</span><span class="p">,</span>
        <span class="n">profile_event_signature</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ProfileEventSignature</span><span class="p">],</span>
        <span class="n">events</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">InstructionEvent</span><span class="p">],</span>
        <span class="n">scale_factor</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a partially constructed Event, populate the fields related to</span>
<span class="sd">        the profile events</span>

<span class="sd">        Fields Updated:</span>
<span class="sd">            name</span>
<span class="sd">            delegate_debug_identifier</span>
<span class="sd">            is_delegated_op</span>
<span class="sd">            perf_data</span>
<span class="sd">            delegate_debug_metadatas</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Fill out fields from profile event signature</span>
        <span class="n">Event</span><span class="o">.</span><span class="n">_populate_event_signature_fields</span><span class="p">(</span><span class="n">ret_event</span><span class="p">,</span> <span class="n">profile_event_signature</span><span class="p">)</span>

        <span class="c1"># Fill out fields from profile event</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">stime</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">delegate_debug_metadatas</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">profile_events</span> <span class="o">:=</span> <span class="n">event</span><span class="o">.</span><span class="n">profile_events</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">profile_events</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Expected exactly one profile event per InstructionEvent when generating Inspector Event, but got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">profile_events</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>

                <span class="n">profile_event</span> <span class="o">=</span> <span class="n">profile_events</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                <span class="c1"># Scale factor should only be applied to non-delegated ops</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">ret_event</span><span class="o">.</span><span class="n">is_delegated_op</span>
                    <span class="ow">and</span> <span class="p">(</span><span class="n">convert_time_scale</span> <span class="o">:=</span> <span class="n">ret_event</span><span class="o">.</span><span class="n">_delegate_time_scale_converter</span><span class="p">)</span>
                    <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="p">):</span>
                    <span class="n">scaled_time</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">_calculate_elapsed_time</span><span class="p">(</span>
                        <span class="n">convert_time_scale</span><span class="p">(</span><span class="n">ret_event</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">profile_event</span><span class="o">.</span><span class="n">start_time</span><span class="p">),</span>
                        <span class="n">convert_time_scale</span><span class="p">(</span><span class="n">ret_event</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">profile_event</span><span class="o">.</span><span class="n">end_time</span><span class="p">),</span>
                    <span class="p">)</span>
                <span class="c1"># If it&#39;s not a delegated op then we can just use the raw time values</span>
                <span class="c1"># and then scale them according to the scale factor that was passed in.</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">ret_event</span><span class="o">.</span><span class="n">is_delegated_op</span><span class="p">:</span>
                    <span class="n">scaled_time</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="nb">float</span><span class="p">(</span>
                            <span class="n">Event</span><span class="o">.</span><span class="n">_calculate_elapsed_time</span><span class="p">(</span>
                                <span class="n">profile_event</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span> <span class="n">profile_event</span><span class="o">.</span><span class="n">end_time</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                        <span class="o">/</span> <span class="n">scale_factor</span>
                    <span class="p">)</span>
                <span class="c1"># If there was no scale factor passed in just take a difference of the</span>
                <span class="c1"># end and start times.</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">scaled_time</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                        <span class="n">Event</span><span class="o">.</span><span class="n">_calculate_elapsed_time</span><span class="p">(</span>
                            <span class="n">profile_event</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span> <span class="n">profile_event</span><span class="o">.</span><span class="n">end_time</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

                <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scaled_time</span><span class="p">)</span>
                <span class="n">stime</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">profile_event</span><span class="o">.</span><span class="n">start_time</span><span class="p">)</span>
                <span class="n">delegate_debug_metadatas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">profile_event</span><span class="o">.</span><span class="n">delegate_debug_metadata</span>
                    <span class="k">if</span> <span class="n">profile_event</span><span class="o">.</span><span class="n">delegate_debug_metadata</span>
                    <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                <span class="p">)</span>

        <span class="c1"># Update fields</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ret_event</span><span class="o">.</span><span class="n">perf_data</span> <span class="o">=</span> <span class="n">PerfData</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">delegate_debug_metadatas</span><span class="p">):</span>
            <span class="n">ret_event</span><span class="o">.</span><span class="n">_delegate_debug_metadatas</span> <span class="o">=</span> <span class="n">delegate_debug_metadatas</span>

        <span class="c1"># add _start_time to the event</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stime</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ret_event</span><span class="o">.</span><span class="n">_start_time</span> <span class="o">=</span> <span class="n">stime</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_populate_debugging_related_fields</span><span class="p">(</span>
        <span class="n">ret_event</span><span class="p">:</span> <span class="s2">&quot;Event&quot;</span><span class="p">,</span>
        <span class="n">debug_event_signature</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DebugEventSignature</span><span class="p">],</span>
        <span class="n">events</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">InstructionEvent</span><span class="p">],</span>
        <span class="n">output_buffer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a partially constructed Event, populate the fields related to</span>
<span class="sd">        the debug events</span>

<span class="sd">        Fields Updated:</span>
<span class="sd">            name</span>
<span class="sd">            delegate_debug_identifier</span>
<span class="sd">            is_delegated_op</span>
<span class="sd">            debug_data</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Fill out fields from debug event signature</span>
        <span class="n">Event</span><span class="o">.</span><span class="n">_populate_event_signature_fields</span><span class="p">(</span><span class="n">ret_event</span><span class="p">,</span> <span class="n">debug_event_signature</span><span class="p">)</span>

        <span class="n">debug_data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">flatcc</span><span class="o">.</span><span class="n">Value</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">debug_events</span> <span class="o">:=</span> <span class="n">event</span><span class="o">.</span><span class="n">debug_events</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Populate on the first iteration only, then verify equivalence for others</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">debug_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">debug_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">debug_event</span><span class="o">.</span><span class="n">debug_entry</span> <span class="k">for</span> <span class="n">debug_event</span> <span class="ow">in</span> <span class="n">debug_events</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">debug_event</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">debug_events</span><span class="p">,</span> <span class="n">debug_data</span><span class="p">):</span>
                    <span class="n">v1</span> <span class="o">=</span> <span class="n">inflate_runtime_output</span><span class="p">(</span><span class="n">debug_event</span><span class="o">.</span><span class="n">debug_entry</span><span class="p">,</span> <span class="n">output_buffer</span><span class="p">)</span>
                    <span class="n">v2</span> <span class="o">=</span> <span class="n">inflate_runtime_output</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">output_buffer</span><span class="p">)</span>
                    <span class="k">assert</span> <span class="n">is_inference_output_equal</span><span class="p">(</span>
                        <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span>
                    <span class="p">),</span> <span class="s2">&quot;&quot;&quot;Corresponding debug events in multiple iterations of the model</span>
<span class="s2">                    must have the same debug entry values. This is not the case for the</span>
<span class="s2">                    intermediate data present in this ETDump and indicates potential issues</span>
<span class="s2">                    with the model/runtime.&quot;&quot;&quot;</span>

        <span class="n">ret_event</span><span class="o">.</span><span class="n">debug_data</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">inflate_runtime_output</span><span class="p">(</span><span class="n">debug_value</span><span class="p">,</span> <span class="n">output_buffer</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">debug_value</span> <span class="ow">in</span> <span class="n">debug_data</span>
        <span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_associate_with_op_graph_nodes</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">debug_handle_to_op_node_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">OperatorNode</span><span class="p">]],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper function to populate the stack_traces, module_hierarchy and op_types attributes</span>
<span class="sd">        based on the debug handles of this event</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Framework events aren&#39;t logically associated with any nodes</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">RESERVED_FRAMEWORK_EVENT_NAMES</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">debug_handles</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_handles</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">debug_handles</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">debug_handles</span> <span class="o">=</span> <span class="p">[</span><span class="n">debug_handles</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">handle</span> <span class="ow">in</span> <span class="n">debug_handles</span><span class="p">:</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="n">debug_handle_to_op_node_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nodes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                <span class="c1"># Attach node metadata including stack traces, module hierarchy and op_types to this event</span>
                <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">metadata</span> <span class="o">:=</span> <span class="n">node</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack_traces</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">stack_traces</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;stack_trace&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">module_hierarchy</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                            <span class="s2">&quot;nn_module_stack&quot;</span>
                        <span class="p">)</span>
                    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="p">:</span>
                        <span class="c1"># TODO: consider having this as a dict from node.name -&gt; node.op</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">op_types</span> <span class="o">+=</span> <span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="p">]</span></div>


<div class="viewcode-block" id="EventBlock"><a class="viewcode-back" href="../../../../model-inspector.html#executorch.devtools.inspector.EventBlock">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">EventBlock</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An `EventBlock` contains a collection of events associated with a particular profiling/debugging block retrieved from the runtime.</span>
<span class="sd">    Each `EventBlock` represents a pattern of execution. For example, model initiation and loading lives in a single `EventBlock`.</span>
<span class="sd">    If there&#39;s a control flow, each branch will be represented by a separate `EventBlock`.</span>

<span class="sd">    Args:</span>
<span class="sd">        name: Name of the profiling/debugging block.</span>
<span class="sd">        events: List of `Event`\ s associated with the profiling/debugging block.</span>

<span class="sd">        bundled_input_idx: Index of the Bundled Input that this EventBlock corresponds to.</span>
<span class="sd">        run_output: Run output extracted from the encapsulated Events</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">events</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Event</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">source_time_scale</span><span class="p">:</span> <span class="n">TimeScale</span> <span class="o">=</span> <span class="n">TimeScale</span><span class="o">.</span><span class="n">NS</span>
    <span class="n">target_time_scale</span><span class="p">:</span> <span class="n">TimeScale</span> <span class="o">=</span> <span class="n">TimeScale</span><span class="o">.</span><span class="n">MS</span>
    <span class="n">bundled_input_index</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">run_output</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ProgramOutput</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">reference_output</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ProgramOutput</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dataframe</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">include_units</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">include_delegate_debug_data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts the EventBlock into a DataFrame with each row being an event instance</span>

<span class="sd">        Note: Rows that have an event_name = OPERATOR_CALL correspond to the perf of the</span>
<span class="sd">            previous operator + framework tax of making said operator call.</span>

<span class="sd">        Args:</span>
<span class="sd">            include_units: Whether headers should include units (default false)</span>
<span class="sd">            include_delegate_debug_data: Whether to show the delegate debug data</span>

<span class="sd">        Returns:</span>
<span class="sd">            A pandas DataFrame containing the data of each Event instance in this EventBlock.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">units</span> <span class="o">=</span> <span class="s2">&quot; (&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_time_scale</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span> <span class="k">if</span> <span class="n">include_units</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">e</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">(</span><span class="n">units</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;event_block_name&quot;</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">))]),</span>
            <span class="n">allow_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Add Delegate Debug Metadata columns</span>
        <span class="k">if</span> <span class="n">include_delegate_debug_data</span><span class="p">:</span>
            <span class="n">delegate_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">metadata</span> <span class="o">:=</span> <span class="n">event</span><span class="o">.</span><span class="n">delegate_debug_metadatas</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span>
                    <span class="n">metadata</span>
                <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                        <span class="n">delegate_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">metadata</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;delegate_debug_metadata&quot;</span><span class="p">])</span>
                        <span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                        <span class="n">delegate_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">metadata</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Unexpected type for delegate_debug_metadata: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">delegate_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">())</span>

            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">empty</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">delegate_data</span><span class="p">):</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">delegate_data</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_gen_from_etdump</span><span class="p">(</span>
        <span class="n">etdump</span><span class="p">:</span> <span class="n">ETDumpFlatCC</span><span class="p">,</span>
        <span class="n">source_time_scale</span><span class="p">:</span> <span class="n">TimeScale</span> <span class="o">=</span> <span class="n">TimeScale</span><span class="o">.</span><span class="n">NS</span><span class="p">,</span>
        <span class="n">target_time_scale</span><span class="p">:</span> <span class="n">TimeScale</span> <span class="o">=</span> <span class="n">TimeScale</span><span class="o">.</span><span class="n">MS</span><span class="p">,</span>
        <span class="n">output_buffer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">delegate_metadata_parser</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Callable</span><span class="p">[[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">delegate_time_scale_converter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Callable</span><span class="p">[[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;EventBlock&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given an etdump, generate a list of EventBlocks corresponding to the</span>
<span class="sd">        contents.</span>

<span class="sd">        An optional (inverse) scale factor can be provided to adjust the</span>
<span class="sd">        etdump timestamps associated with each EventBlocks</span>

<span class="sd">        An optional buffer to inflate etdump references</span>

<span class="sd">        An optional delegate metadata parser function to parse delegate profiling metadata</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Map each RunSignatures to instances of its constituent events.</span>
        <span class="c1">#   The value of the map is a GroupedRunInstance which contains:</span>
        <span class="c1">#   (1) a map from each EventSignature to InstructionEvents with the signature</span>
        <span class="c1">#   (2) the run output for this RunSignature</span>
        <span class="nd">@dataclass</span>
        <span class="k">class</span><span class="w"> </span><span class="nc">GroupedRunInstances</span><span class="p">:</span>
            <span class="n">events</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">[</span><span class="n">EventSignature</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">InstructionEvent</span><span class="p">]]</span>
            <span class="n">run_output</span><span class="p">:</span> <span class="n">ProgramOutput</span>

        <span class="n">run_groups</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">RunSignature</span><span class="p">,</span> <span class="n">GroupedRunInstances</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="n">GroupedRunInstances</span><span class="p">(</span><span class="n">OrderedDict</span><span class="p">(),</span> <span class="p">[])</span>
        <span class="p">)</span>

        <span class="c1"># Collect all the run data</span>
        <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">etdump</span><span class="o">.</span><span class="n">run_data</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">run_events</span> <span class="o">:=</span> <span class="n">run</span><span class="o">.</span><span class="n">events</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Collate the run_events into InstructionEvents</span>
            <span class="n">instruction_events</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">InstructionEvent</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">InstructionEvent</span><span class="o">.</span><span class="n">gen_from_events</span><span class="p">(</span><span class="n">run_events</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># Map EventSignatures to the InstructionEvents</span>
            <span class="n">event_signatures</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">EventSignature</span><span class="p">,</span> <span class="n">InstructionEvent</span><span class="p">]</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">instruction_event</span> <span class="ow">in</span> <span class="n">instruction_events</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">instruction_event</span><span class="o">.</span><span class="n">debug_events</span> <span class="ow">is</span> <span class="kc">None</span>
                    <span class="ow">and</span> <span class="n">instruction_event</span><span class="o">.</span><span class="n">profile_events</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="p">):</span>
                    <span class="c1"># Currently corresponds to run output</span>
                    <span class="k">continue</span>

                <span class="n">generated_event_signatures</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span>
                    <span class="n">Tuple</span><span class="p">[</span><span class="n">EventSignature</span><span class="p">,</span> <span class="n">InstructionEvent</span><span class="p">]</span>
                <span class="p">]</span> <span class="o">=</span> <span class="n">EventSignature</span><span class="o">.</span><span class="n">gen_from_instruction_event</span><span class="p">(</span><span class="n">instruction_event</span><span class="p">)</span>
                <span class="k">for</span> <span class="p">(</span>
                    <span class="n">event_signature</span><span class="p">,</span>
                    <span class="n">filtered_instruction_event</span><span class="p">,</span>
                <span class="p">)</span> <span class="ow">in</span> <span class="n">generated_event_signatures</span><span class="p">:</span>
                    <span class="n">event_signatures</span><span class="p">[</span><span class="n">event_signature</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtered_instruction_event</span>

            <span class="c1"># Create a RunSignature from the EventSignatures</span>
            <span class="n">run_signature</span> <span class="o">=</span> <span class="n">RunSignature</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">run</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">events</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">event_signatures</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                <span class="n">bundled_input_index</span><span class="o">=</span><span class="n">run</span><span class="o">.</span><span class="n">bundled_input_index</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Update the Run Groups, indexed on the RunSignature</span>
            <span class="n">run_signature_events</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">[</span>
                <span class="n">EventSignature</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">InstructionEvent</span><span class="p">]</span>
            <span class="p">]</span> <span class="o">=</span> <span class="n">run_groups</span><span class="p">[</span><span class="n">run_signature</span><span class="p">]</span><span class="o">.</span><span class="n">events</span>
            <span class="k">for</span> <span class="n">event_signature</span><span class="p">,</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">event_signatures</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">run_signature_events</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">event_signature</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

            <span class="c1"># Populate (or Verify if already populated) Run Outputs</span>
            <span class="n">run_outputs</span><span class="p">:</span> <span class="n">ProgramOutput</span> <span class="o">=</span> <span class="n">EventBlock</span><span class="o">.</span><span class="n">_collect_run_outputs</span><span class="p">(</span>
                <span class="n">run_events</span><span class="p">,</span> <span class="n">output_buffer</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">existing_run_outputs</span> <span class="o">:=</span> <span class="n">run_groups</span><span class="p">[</span><span class="n">run_signature</span><span class="p">]</span><span class="o">.</span><span class="n">run_output</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">existing_run_outputs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">run_outputs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">verify_debug_data_equivalence</span><span class="p">(</span><span class="n">existing_run_outputs</span><span class="p">,</span> <span class="n">run_outputs</span><span class="p">)</span>

        <span class="c1"># Construct the EventBlocks</span>
        <span class="n">event_blocks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">scale_factor</span> <span class="o">=</span> <span class="n">calculate_time_scale_factor</span><span class="p">(</span><span class="n">source_time_scale</span><span class="p">,</span> <span class="n">target_time_scale</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">run_signature</span><span class="p">,</span> <span class="n">grouped_run_instance</span> <span class="ow">in</span> <span class="n">run_groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">run_group</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">[</span><span class="n">EventSignature</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">InstructionEvent</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">grouped_run_instance</span><span class="o">.</span><span class="n">events</span>
            <span class="p">)</span>
            <span class="n">run_outputs</span><span class="p">:</span> <span class="n">ProgramOutput</span> <span class="o">=</span> <span class="n">grouped_run_instance</span><span class="o">.</span><span class="n">run_output</span>

            <span class="c1"># Construct the Events</span>
            <span class="n">events</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Event</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">Event</span><span class="o">.</span><span class="n">_gen_from_inference_events</span><span class="p">(</span>
                    <span class="n">signature</span><span class="p">,</span>
                    <span class="n">instruction_events</span><span class="p">,</span>
                    <span class="n">scale_factor</span><span class="p">,</span>
                    <span class="n">output_buffer</span><span class="p">,</span>
                    <span class="n">delegate_metadata_parser</span><span class="p">,</span>
                    <span class="n">delegate_time_scale_converter</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">signature</span><span class="p">,</span> <span class="n">instruction_events</span> <span class="ow">in</span> <span class="n">run_group</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">]</span>

            <span class="c1"># Add the EventBlock to the return list</span>
            <span class="n">event_blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">EventBlock</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">run_signature</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">events</span><span class="o">=</span><span class="n">events</span><span class="p">,</span>
                    <span class="n">source_time_scale</span><span class="o">=</span><span class="n">source_time_scale</span><span class="p">,</span>
                    <span class="n">target_time_scale</span><span class="o">=</span><span class="n">target_time_scale</span><span class="p">,</span>
                    <span class="n">bundled_input_index</span><span class="o">=</span><span class="n">run_signature</span><span class="o">.</span><span class="n">bundled_input_index</span><span class="p">,</span>
                    <span class="n">run_output</span><span class="o">=</span><span class="n">run_outputs</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">event_blocks</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_collect_run_outputs</span><span class="p">(</span>
        <span class="n">events</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">flatcc</span><span class="o">.</span><span class="n">Event</span><span class="p">],</span> <span class="n">output_buffer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ProgramOutput</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a list of events, search the events for ProgramOutputs (aka lists of InferenceOutputs) marked</span>
<span class="sd">        as run outputs</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">output_events</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">debug_event</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">debug_event</span><span class="o">.</span><span class="n">debug_entry</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;Debug entry inside debug event should not be empty!&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">is_debug_output</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">debug_event</span><span class="o">.</span><span class="n">debug_entry</span><span class="p">):</span>
                <span class="n">output_events</span> <span class="o">+=</span> <span class="p">[</span><span class="n">event</span><span class="p">]</span>

        <span class="k">return</span> <span class="p">[</span>
            <span class="n">inflate_runtime_output</span><span class="p">(</span><span class="n">debug_event</span><span class="o">.</span><span class="n">debug_entry</span><span class="p">,</span> <span class="n">output_buffer</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">output_event</span> <span class="ow">in</span> <span class="n">output_events</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">debug_event</span> <span class="o">:=</span> <span class="n">output_event</span><span class="o">.</span><span class="n">debug_event</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">]</span>

    <span class="c1"># TODO: Considering changing ETRecord deserialization logic to cast the ints in string format to actual ints</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_gen_resolve_debug_handles</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">handle_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
        <span class="n">delegate_map</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DelegateMetadata</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">instruction_id_to_num_outs_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given mappings from instruction id to debug handles, populate the</span>
<span class="sd">        debug_handles field of all underlying events</span>

<span class="sd">        If the event is delegated, index with the instruction_id and delegate_debug_identifier</span>
<span class="sd">        to obtain the debug_handle via the delegate map</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">:</span>
            <span class="c1"># Check if instruction_id is present in the event</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">_instruction_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Check for the instruction_id in handle map</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">instruction_id</span> <span class="o">:=</span> <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">_instruction_id</span><span class="p">))</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">handle_map</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">num_outputs</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">instruction_id_to_num_outs_map</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">num_outputs</span> <span class="o">=</span> <span class="n">instruction_id_to_num_outs_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">instruction_id</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">event</span><span class="o">.</span><span class="n">num_outputs</span> <span class="o">=</span> <span class="n">num_outputs</span>
            <span class="c1"># For non-delegated event, handles are found in handle_map</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">delegate_debug_id</span> <span class="o">:=</span> <span class="n">event</span><span class="o">.</span><span class="n">delegate_debug_identifier</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">event</span><span class="o">.</span><span class="n">debug_handles</span> <span class="o">=</span> <span class="n">handle_map</span><span class="p">[</span><span class="n">instruction_id</span><span class="p">]</span>

                <span class="c1"># DELEGATE_CALL is a special non-delegated event and benefits from having the name populated</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">event</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;DELEGATE_CALL&quot;</span>
                    <span class="ow">and</span> <span class="n">delegate_map</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="ow">and</span> <span class="p">(</span><span class="n">delegate_metadata</span> <span class="o">:=</span> <span class="n">delegate_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">instruction_id</span><span class="p">))</span>
                    <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="p">):</span>
                    <span class="n">event</span><span class="o">.</span><span class="n">delegate_backend_name</span> <span class="o">=</span> <span class="n">delegate_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

                <span class="k">continue</span>

            <span class="c1"># Check that the delegated event has a corresponding mapping</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">delegate_map</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="ow">or</span> <span class="p">(</span><span class="n">delegate_metadata</span> <span class="o">:=</span> <span class="n">delegate_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">instruction_id</span><span class="p">))</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="p">):</span>
                <span class="n">event</span><span class="o">.</span><span class="n">debug_handles</span> <span class="o">=</span> <span class="n">handle_map</span><span class="p">[</span><span class="n">instruction_id</span><span class="p">]</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot; No delegate mapping found for delegate with instruction id </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">_instruction_id</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># For delegated events, handles are found via delegateMetadata</span>
            <span class="n">event</span><span class="o">.</span><span class="n">delegate_backend_name</span> <span class="o">=</span> <span class="n">delegate_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">delegate_metadata_delegate_map</span> <span class="o">=</span> <span class="n">delegate_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;delegate_map&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>

            <span class="c1"># delegate_debug_id can be either int based or string based, therefore we need to check both</span>
            <span class="n">debug_handles</span> <span class="o">=</span> <span class="n">delegate_metadata_delegate_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="n">delegate_debug_id</span>  <span class="c1"># pyre-ignore</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">debug_handles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">event</span><span class="o">.</span><span class="n">debug_handles</span> <span class="o">=</span> <span class="n">debug_handles</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">event</span><span class="o">.</span><span class="n">debug_handles</span> <span class="o">=</span> <span class="n">delegate_metadata_delegate_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">delegate_debug_id</span><span class="p">)</span>  <span class="c1"># pyre-ignore</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">delegate_metadata_delegate_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">delegate_debug_id</span><span class="p">):</span>
                        <span class="n">event</span><span class="o">.</span><span class="n">debug_handles</span> <span class="o">=</span> <span class="n">value</span></div>


<span class="k">class</span><span class="w"> </span><span class="nc">Inspector</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    APIs for examining model architecture and performance stats.</span>

<span class="sd">    Public Attributes:</span>
<span class="sd">        event_blocks: List[&quot;EventBlocks&quot;]. Structured data from ETDump (correlated with ETRecord if provided).</span>

<span class="sd">    Private Attributes:</span>
<span class="sd">        _etrecord: Optional[ETRecord]. File under etrecord_path deserialized into an object.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">etdump_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">etdump_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">etrecord</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">ETRecord</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">source_time_scale</span><span class="p">:</span> <span class="n">TimeScale</span> <span class="o">=</span> <span class="n">TimeScale</span><span class="o">.</span><span class="n">NS</span><span class="p">,</span>
        <span class="n">target_time_scale</span><span class="p">:</span> <span class="n">TimeScale</span> <span class="o">=</span> <span class="n">TimeScale</span><span class="o">.</span><span class="n">MS</span><span class="p">,</span>
        <span class="n">debug_buffer_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">delegate_metadata_parser</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Callable</span><span class="p">[[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">delegate_time_scale_converter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Callable</span><span class="p">[[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">enable_module_hierarchy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize an `Inspector` instance with the underlying `EventBlock`\ s populated with data from the provided ETDump path or binary,</span>
<span class="sd">        and optional ETRecord path.</span>

<span class="sd">        Args:</span>
<span class="sd">            etdump_path: Path to the ETDump file. Either this parameter or etdump_data should be provided.</span>
<span class="sd">            etdump_data: ETDump binary. Either this parameter or etdump_path should be provided.</span>
<span class="sd">            etrecord: Optional ETRecord object or path to the ETRecord file.</span>
<span class="sd">            source_time_scale: The time scale of the performance data retrieved from the runtime. The default time hook implentation in the runtime returns NS.</span>
<span class="sd">            target_time_scale: The target time scale to which the users want their performance data converted to. Defaults to MS.</span>
<span class="sd">            debug_buffer_path: Debug buffer file path that contains the debug data referenced by ETDump for intermediate and program outputs.</span>
<span class="sd">            delegate_metadata_parser: Optional function to parse delegate metadata from an Profiling Event. Expected signature of the function is:</span>
<span class="sd">                    (delegate_metadata_list: List[bytes]) -&gt; Union[List[str], Dict[str, Any]]</span>
<span class="sd">            delegate_time_scale_converter: Optional function to convert the time scale of delegate profiling data. If not given, use the conversion ratio of</span>
<span class="sd">                    target_time_scale/source_time_scale.</span>
<span class="sd">            enable_module_hierarchy: Enable submodules in the operator graph. Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">source_time_scale</span> <span class="o">==</span> <span class="n">TimeScale</span><span class="o">.</span><span class="n">CYCLES</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span>
            <span class="n">target_time_scale</span> <span class="o">==</span> <span class="n">TimeScale</span><span class="o">.</span><span class="n">CYCLES</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;For TimeScale in cycles both the source and target time scale have to be in cycles.&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_source_time_scale</span> <span class="o">=</span> <span class="n">source_time_scale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_target_time_scale</span> <span class="o">=</span> <span class="n">target_time_scale</span>

        <span class="k">if</span> <span class="n">delegate_time_scale_converter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">scale_factor</span> <span class="o">=</span> <span class="n">calculate_time_scale_factor</span><span class="p">(</span>
                <span class="n">source_time_scale</span><span class="p">,</span> <span class="n">target_time_scale</span>
            <span class="p">)</span>
            <span class="n">delegate_time_scale_converter</span> <span class="o">=</span> <span class="p">(</span>
                <span class="k">lambda</span> <span class="n">event_name</span><span class="p">,</span> <span class="n">input_time</span><span class="p">:</span> <span class="n">input_time</span> <span class="o">/</span> <span class="n">scale_factor</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">etrecord</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_etrecord</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">etrecord</span><span class="p">,</span> <span class="n">ETRecord</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_etrecord</span> <span class="o">=</span> <span class="n">etrecord</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">etrecord</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_etrecord</span> <span class="o">=</span> <span class="n">parse_etrecord</span><span class="p">(</span><span class="n">etrecord_path</span><span class="o">=</span><span class="n">etrecord</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Unsupported ETRecord type&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">etdump_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">etdump_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Expecting exactly one of etdump_path or etdump_data to be specified.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Create EventBlocks from ETDump</span>
        <span class="n">etdump</span> <span class="o">=</span> <span class="n">gen_etdump_object</span><span class="p">(</span><span class="n">etdump_path</span><span class="o">=</span><span class="n">etdump_path</span><span class="p">,</span> <span class="n">etdump_data</span><span class="o">=</span><span class="n">etdump_data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">debug_buffer_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">debug_buffer_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">output_buffer</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output_buffer</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Output Buffer not found. Tensor Debug Data will not be available.&quot;</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">event_blocks</span> <span class="o">=</span> <span class="n">EventBlock</span><span class="o">.</span><span class="n">_gen_from_etdump</span><span class="p">(</span>
            <span class="n">etdump</span><span class="o">=</span><span class="n">etdump</span><span class="p">,</span>
            <span class="n">source_time_scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_source_time_scale</span><span class="p">,</span>
            <span class="n">target_time_scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_target_time_scale</span><span class="p">,</span>
            <span class="n">output_buffer</span><span class="o">=</span><span class="n">output_buffer</span><span class="p">,</span>
            <span class="n">delegate_metadata_parser</span><span class="o">=</span><span class="n">delegate_metadata_parser</span><span class="p">,</span>
            <span class="n">delegate_time_scale_converter</span><span class="o">=</span><span class="n">delegate_time_scale_converter</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Connect ETRecord to EventBlocks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op_graph_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">OperatorGraph</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># _consume_etrecord() will populate the _reference_outputs dict</span>
        <span class="c1"># Key str is method name; value is list of ProgramOutputs because of list of test cases</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reference_outputs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">ProgramOutput</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enable_module_hierarchy</span> <span class="o">=</span> <span class="n">enable_module_hierarchy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_consume_etrecord</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_consume_etrecord</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If an ETRecord is provided, connect it to the EventBlocks and populate the Event metadata.</span>

<span class="sd">        Steps:</span>
<span class="sd">            1. Debug Handle Symbolification:</span>
<span class="sd">                For each Event, find the debug_handle counterparts using</span>
<span class="sd">                ETRecord&#39;s debug_handle_map and delegate_map</span>

<span class="sd">            2. Event Metadata Association:</span>
<span class="sd">                For each Event, populate its metadata from OperatorGraph Nodes,</span>
<span class="sd">                generated from ETRecord. The debug_handle is used to</span>
<span class="sd">                identify the corresponding OperatorGraph Nodes.</span>

<span class="sd">            3. Reference Outputs Extraction:</span>
<span class="sd">                If there&#39;re reference outputs saved in ETRecord, assign each reference output to the corresponding</span>
<span class="sd">                EventBlock based on the method name (currently assumes only &quot;forward&quot;) and the</span>
<span class="sd">                bundled_input_index of the EventBlock.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_etrecord</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># (1) Debug Handle Symbolification</span>
        <span class="k">for</span> <span class="n">event_block</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_blocks</span><span class="p">:</span>
            <span class="n">event_block</span><span class="o">.</span><span class="n">_gen_resolve_debug_handles</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_etrecord</span><span class="o">.</span><span class="n">_debug_handle_map</span><span class="p">[</span><span class="n">FORWARD</span><span class="p">],</span>
                <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_etrecord</span><span class="o">.</span><span class="n">_delegate_map</span><span class="p">[</span><span class="n">FORWARD</span><span class="p">]</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_etrecord</span><span class="o">.</span><span class="n">_delegate_map</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="k">else</span> <span class="kc">None</span>
                <span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_etrecord</span><span class="o">.</span><span class="n">_instruction_id_to_num_outs_map</span><span class="p">[</span><span class="n">FORWARD</span><span class="p">],</span>
            <span class="p">)</span>

        <span class="c1"># (2) Event Metadata Association</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op_graph_dict</span> <span class="o">=</span> <span class="n">gen_graphs_from_etrecord</span><span class="p">(</span>
            <span class="n">etrecord</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_etrecord</span><span class="p">,</span>
            <span class="n">enable_module_hierarchy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_enable_module_hierarchy</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">debug_handle_to_op_node_map</span> <span class="o">=</span> <span class="n">create_debug_handle_to_op_node_mapping</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">op_graph_dict</span><span class="p">[</span><span class="n">EDGE_DIALECT_GRAPH_KEY</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">event_block</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_blocks</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">event_block</span><span class="o">.</span><span class="n">events</span><span class="p">:</span>
                <span class="n">event</span><span class="o">.</span><span class="n">_associate_with_op_graph_nodes</span><span class="p">(</span>
                    <span class="n">debug_handle_to_op_node_map</span><span class="o">=</span><span class="n">debug_handle_to_op_node_map</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="c1"># (3) Reference Outputs Extraction</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_etrecord</span><span class="o">.</span><span class="n">_reference_outputs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reference_outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_etrecord</span><span class="o">.</span><span class="n">_reference_outputs</span>
            <span class="c1"># Associate each reference output to the corresponding event block</span>
            <span class="k">for</span> <span class="n">event_block</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_blocks</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">event_block</span><span class="o">.</span><span class="n">bundled_input_index</span>
                <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">event_block</span><span class="o">.</span><span class="n">reference_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reference_outputs</span><span class="p">[</span><span class="n">FORWARD</span><span class="p">][</span>
                        <span class="n">index</span>
                    <span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_aot_intermediate_outputs_and_op_names</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">disable_debug_handle_valdiation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">DebugHandle</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="n">DebugHandle</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Capture intermediate outputs only if _representative_inputs are provided</span>
<span class="sd">        when using bundled program to create the etrecord</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_etrecord</span><span class="o">.</span><span class="n">_representative_inputs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{},</span> <span class="p">{}</span>

        <span class="n">export_program</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Will use the exported program to extract intermediate output if and only if exported_program has been provided, and it is one of the ancestors of the edge_dialect_program</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_etrecord</span><span class="o">.</span><span class="n">exported_program</span> <span class="ow">and</span> <span class="n">propagate_back_debug_handle</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_etrecord</span><span class="o">.</span><span class="n">exported_program</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_etrecord</span><span class="o">.</span><span class="n">export_graph_id</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_etrecord</span><span class="o">.</span><span class="n">edge_dialect_program</span><span class="p">,</span>
            <span class="n">disable_debug_handle_valdiation</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="n">export_program</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_etrecord</span><span class="o">.</span><span class="n">exported_program</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Either aten dialect exported program is not in ETRecord, or it is not one of the ancestors of current edge dialect program.&quot;</span>
                <span class="s2">&quot;Will fall back to use edge dialect program to extract intermediate output&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">export_program</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_etrecord</span><span class="o">.</span><span class="n">edge_dialect_program</span>
        <span class="n">graph_module</span> <span class="o">=</span> <span class="n">export_program</span><span class="o">.</span><span class="n">module</span><span class="p">()</span>
        <span class="n">aot_debug_handle_to_op_name</span> <span class="o">=</span> <span class="n">get_aot_debug_handle_to_op_name_mapping</span><span class="p">(</span>
            <span class="n">graph_module</span>
        <span class="p">)</span>
        <span class="n">capturer</span> <span class="o">=</span> <span class="n">IntermediateOutputCapturer</span><span class="p">(</span><span class="n">graph_module</span><span class="p">)</span>
        <span class="n">aot_intermediate_outputs</span> <span class="o">=</span> <span class="n">capturer</span><span class="o">.</span><span class="n">run_and_capture</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_etrecord</span><span class="o">.</span><span class="n">_representative_inputs</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">aot_intermediate_outputs</span><span class="p">,</span> <span class="n">aot_debug_handle_to_op_name</span>

    <span class="c1"># TODO: Make it more extensible to further merge overlapping debug handles</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_runtime_intermediate_outputs_and_op_names</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">DebugHandle</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">Dict</span><span class="p">[</span><span class="n">DebugHandle</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the runtime intermediate outputs(debug handles and intermediate values mappings)</span>
<span class="sd">        from the event blocks, along with the corresponding debug handles and op names mapping.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">debug_handle_to_output</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">debug_handle_to_op_names</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">event_block</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_blocks</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">event_block</span><span class="o">.</span><span class="n">events</span><span class="p">:</span>
                <span class="c1"># Skip OPERATOR_CALL events to avoid double-counting and exclude framework tax</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">event</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">EXCLUDED_EVENTS_FOR_INTERMEDIATE_OUTPUT</span>
                    <span class="ow">or</span> <span class="ow">not</span> <span class="n">event</span><span class="o">.</span><span class="n">op_types</span>
                <span class="p">):</span>
                    <span class="k">continue</span>
                <span class="c1"># Normalize debug_handle to a tuple</span>
                <span class="n">debug_handle</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">debug_handles</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">debug_handle</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="n">debug_handle</span> <span class="o">=</span> <span class="p">(</span><span class="n">debug_handle</span><span class="p">,)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">debug_handle</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">debug_handle</span><span class="p">)</span>
                <span class="n">current_entry</span> <span class="o">=</span> <span class="n">debug_handle_to_output</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="n">debug_handle</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">num_outputs</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="c1"># When event has same debug_handle, only keep the one with the largest instruction id</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">_instruction_id</span> <span class="o">&gt;</span> <span class="n">current_entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">debug_handle_to_output</span><span class="p">[</span><span class="n">debug_handle</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">event</span><span class="o">.</span><span class="n">_instruction_id</span><span class="p">,</span>
                        <span class="n">event</span><span class="o">.</span><span class="n">debug_data</span><span class="p">,</span>
                        <span class="n">event</span><span class="o">.</span><span class="n">num_outputs</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="c1"># TODO: One debug handle can be associated with multiple op names</span>
                    <span class="n">debug_handle_to_op_names</span><span class="p">[</span><span class="n">debug_handle</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>

        <span class="n">debug_handle_to_output</span> <span class="o">=</span> <span class="n">merge_runtime_overlapping_debug_handles</span><span class="p">(</span>
            <span class="n">debug_handle_to_output</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">debug_handle_to_output</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">},</span> <span class="n">debug_handle_to_op_names</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dataframe</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">include_units</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">include_delegate_debug_data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            include_units: Whether headers should include units (default true)</span>
<span class="sd">            include_delegate_debug_data: Whether to include delegate debug metadata (default false)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Returns a pandas DataFrame of the Events in each EventBlock in the inspector, with each row representing an Event.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">df_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">event_block</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">(</span>
                <span class="n">include_units</span><span class="o">=</span><span class="n">include_units</span><span class="p">,</span>
                <span class="n">include_delegate_debug_data</span><span class="o">=</span><span class="n">include_delegate_debug_data</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">event_block</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_blocks</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_list</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_prepare_dataframe</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">include_units</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">include_delegate_debug_data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            include_units: Whether headers should include units (default true)</span>
<span class="sd">            include_delegate_debug_data: Whether to include delegate debug metadata (default false)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Returns a pandas DataFrame of the Events in each EventBlock in the inspector, with additional filtering.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">combined_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">(</span><span class="n">include_units</span><span class="p">,</span> <span class="n">include_delegate_debug_data</span><span class="p">)</span>

        <span class="c1"># Filter out some columns and rows for better readability when printing</span>
        <span class="n">filtered_column_df</span> <span class="o">=</span> <span class="n">combined_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">EXCLUDED_COLUMNS_WHEN_PRINTING</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">filter_name</span> <span class="ow">in</span> <span class="n">EXCLUDED_EVENTS_WHEN_PRINTING</span><span class="p">:</span>
            <span class="n">filtered_column_df</span> <span class="o">=</span> <span class="n">filtered_column_df</span><span class="p">[</span>
                <span class="o">~</span><span class="n">filtered_column_df</span><span class="p">[</span><span class="s2">&quot;event_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">filter_name</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="n">filtered_column_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">filtered_column_df</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">print_data_tabular</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">file</span><span class="p">:</span> <span class="n">IO</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span>
        <span class="n">include_units</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">include_delegate_debug_data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displays the underlying EventBlocks in a structured tabular format, with each row representing an Event.</span>

<span class="sd">        Args:</span>
<span class="sd">            file: Which IO stream to print to. Defaults to stdout.</span>
<span class="sd">                Not used if this is in an IPython environment such as a Jupyter notebook.</span>
<span class="sd">            include_units: Whether headers should include units (default true)</span>
<span class="sd">            include_delegate_debug_data: Whether to include delegate debug metadata (default false)</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_dataframe</span><span class="p">(</span><span class="n">include_units</span><span class="p">,</span> <span class="n">include_delegate_debug_data</span><span class="p">)</span>
        <span class="n">display_or_print_df</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save_data_to_tsv</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">file</span><span class="p">:</span> <span class="n">IO</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">include_units</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">include_delegate_debug_data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stores the underlying EventBlocks in tsv format to facilitate copy-paste into spreadsheets.</span>

<span class="sd">        Args:</span>
<span class="sd">            file: Which IO stream to print to. Do not use stdout, as tab separator is not preserved.</span>
<span class="sd">            include_units: Whether headers should include units (default true)</span>
<span class="sd">            include_delegate_debug_data: Whether to include delegate debug metadata (default false)</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_dataframe</span><span class="p">(</span><span class="n">include_units</span><span class="p">,</span> <span class="n">include_delegate_debug_data</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># TODO: write unit test</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_total_for_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the total average compute time of all operators within the specified module.</span>

<span class="sd">        Args:</span>
<span class="sd">            module_name: Name of the module to be aggregated against.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Sum of the average compute time (in seconds) of all operators within the module with &quot;module_name&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">total</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_blocks</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">events</span><span class="p">:</span>
                <span class="c1"># Skip OPERATOR_CALL events to avoid double-counting and exclude framework tax</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;OPERATOR_CALL&quot;</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="n">module_hierarchy</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">module_hierarchy</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">hierarchy</span> <span class="ow">in</span> <span class="n">module_hierarchy</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">hierarchy</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">found</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">module_name</span> <span class="ow">in</span> <span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">hierarchy</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                    <span class="k">if</span> <span class="n">found</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">perf_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">total</span> <span class="o">+=</span> <span class="n">event</span><span class="o">.</span><span class="n">perf_data</span><span class="o">.</span><span class="n">avg</span>
                        <span class="k">break</span>
        <span class="k">return</span> <span class="n">total</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_op_list</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">event_block</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">show_delegated_ops</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Event</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a map of op_types to Events of that op_type</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: implement</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">write_tensorboard_artifact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write to the provided path, the artifacts required for visualization in TensorBoard</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: implement</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_exported_program</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ExportedProgram</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Access helper for ETRecord, defaults to returning the Edge Dialect program.</span>

<span class="sd">        Args:</span>
<span class="sd">            graph: Optional name of the graph to access. If None, returns the Edge Dialect program.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The ExportedProgram object of &quot;graph&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_etrecord</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Exported program is only available when a valid etrecord_path was provided at the time of Inspector construction&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_etrecord</span><span class="o">.</span><span class="n">edge_dialect_program</span>
            <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_etrecord</span><span class="o">.</span><span class="n">graph_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_numeric_gap</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">distance</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;MSE&quot;</span><span class="p">,</span> <span class="n">disable_debug_handle_valdiation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compares logged intermediate outputs from the exported graph (in ETRecord)</span>
<span class="sd">        with runtime outputs (in ETDump) using a user-specific numerical comparator.</span>
<span class="sd">        If the exported graph is not supported, the function will fall back to use edge dialect graph.</span>

<span class="sd">        To use this function, you must first generate the ETRecord with representative inputs,</span>
<span class="sd">        and then create the Inspector instance with the ETRecord and ETDump. The Inspector can then</span>
<span class="sd">        compare the intermediate outputs from the AOT and the runtime.</span>

<span class="sd">        Args:</span>
<span class="sd">            distance: the metrics the inspector will use for gap calculation. Should be one of &quot;MSE&quot;, &quot;L1&quot; and &quot;SNR&quot;.</span>
<span class="sd">            disable_debug_handle_validation: Often when aten graph has symbolic shape nodes, and inbuilt ops like gt/lt etc.,</span>
<span class="sd">            during re-export of such a graph &#39;from_node&#39; information is lost from node.meta. As a result we loose connection</span>
<span class="sd">            between edge IR nodes and aten nodes for such ops. By default we validate that every edge IR node has corresponding</span>
<span class="sd">            node in aten IR, and when such validation fails numeric debugger falls back to edge IR as reference graph. This</span>
<span class="sd">            flag allows one to override such behavior and make best effort comparison.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: A DataFrame listing corresponding operator intermediate outputs from both stages and their computed numerical gaps.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">aot_intermediate_outputs</span><span class="p">,</span> <span class="n">aot_debug_handle_to_op_names</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_aot_intermediate_outputs_and_op_names</span><span class="p">(</span>
                <span class="n">disable_debug_handle_valdiation</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">aot_intermediate_outputs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">aot_debug_handle_to_op_names</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Missing etrecord or missing representative inputs within etrecord, both of which are required for calculating numerical gap&quot;</span>
            <span class="p">)</span>
        <span class="c1"># The runtime_op_names will be used later to map runtime debug_handle to op_name</span>
        <span class="n">runtime_intermediate_outputs</span><span class="p">,</span> <span class="n">runtime_debug_handle_to_op_names</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_runtime_intermediate_outputs_and_op_names</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">mapping</span> <span class="o">=</span> <span class="n">map_runtime_aot_intermediate_outputs</span><span class="p">(</span>
            <span class="n">aot_intermediate_outputs</span><span class="p">,</span> <span class="n">runtime_intermediate_outputs</span>
        <span class="p">)</span>
        <span class="n">metric</span> <span class="o">=</span> <span class="n">distance</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">metric</span> <span class="o">==</span> <span class="s2">&quot;MSE&quot;</span><span class="p">:</span>
            <span class="n">comparator</span> <span class="o">=</span> <span class="n">MSEComparator</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">metric</span> <span class="o">==</span> <span class="s2">&quot;L1&quot;</span><span class="p">:</span>
            <span class="n">comparator</span> <span class="o">=</span> <span class="n">L1Comparator</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">metric</span> <span class="o">==</span> <span class="s2">&quot;SNR&quot;</span><span class="p">:</span>
            <span class="n">comparator</span> <span class="o">=</span> <span class="n">SNRComparator</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported distance metric </span><span class="si">{</span><span class="n">distance</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">aot_debug_handle</span><span class="p">,</span> <span class="n">aot_intermediate_output</span><span class="p">),</span> <span class="p">(</span>
            <span class="n">runtime_debug_handle</span><span class="p">,</span>
            <span class="n">runtime_intermediate_output</span><span class="p">,</span>
        <span class="p">)</span> <span class="ow">in</span> <span class="n">mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">aot_intermediate_output</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">runtime_intermediate_output</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># If aot outputs length is &gt; 1 then comparison fails since we dont really have</span>
            <span class="c1"># any instances where runtime intermediate output is a tuple or list</span>
            <span class="c1"># This does not happen when edge dialect program is reference for comparison</span>
            <span class="c1"># but happens in aten graph where ops like unbind remain undecomposed</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">aot_intermediate_output</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)</span>
                <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">aot_intermediate_output</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
            <span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;aot_ops&quot;</span><span class="p">:</span> <span class="n">find_op_names</span><span class="p">(</span>
                        <span class="n">aot_debug_handle</span><span class="p">,</span> <span class="n">aot_debug_handle_to_op_names</span>
                    <span class="p">),</span>
                    <span class="s2">&quot;aot_intermediate_output&quot;</span><span class="p">:</span> <span class="n">aot_intermediate_output</span><span class="p">,</span>
                    <span class="s2">&quot;runtime_ops&quot;</span><span class="p">:</span> <span class="n">find_op_names</span><span class="p">(</span>
                        <span class="n">runtime_debug_handle</span><span class="p">,</span> <span class="n">runtime_debug_handle_to_op_names</span>
                    <span class="p">),</span>
                    <span class="s2">&quot;runtime_intermediate_output&quot;</span><span class="p">:</span> <span class="n">runtime_intermediate_output</span><span class="p">,</span>
                    <span class="s2">&quot;gap&quot;</span><span class="p">:</span> <span class="n">compare_intermediate_outputs</span><span class="p">(</span>
                        <span class="n">aot_intermediate_output</span><span class="p">,</span> <span class="n">runtime_intermediate_output</span><span class="p">,</span> <span class="n">comparator</span>
                    <span class="p">),</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
</pre></div>

             </article>
             
            </div>
            <footer>
  

  

    <hr>

  

  <div role="contentinfo">
    <p>
        &copy; Copyright 2024, ExecuTorch.

    </p>
  </div>
    
      <div>
        Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
      </div>
     

</footer>

          </div>


        </div>

        <div class="pytorch-content-right" id="pytorch-content-right">
          <div class="pytorch-right-menu" id="pytorch-right-menu">
            <div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
              
            </div>
          </div>
        </div>
      </section>
    </div>

  


  

     
       <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
         <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
         <script src="../../../../_static/jquery.js"></script>
         <script src="../../../../_static/underscore.js"></script>
         <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
         <script src="../../../../_static/doctools.js"></script>
         <script src="../../../../_static/sphinx_highlight.js"></script>
         <script src="../../../../_static/clipboard.min.js"></script>
         <script src="../../../../_static/copybutton.js"></script>
         <script src="../../../../_static/design-tabs.js"></script>
         <script src="../../../../_static/js/progress-bar.js"></script>
     

  

  <script type="text/javascript" src="../../../../_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="../../../../_static/js/vendor/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
  <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>
 
<script script type="text/javascript">
  var collapsedSections = ['Introduction', 'Getting Started', 'Working with LLMs', 'Exporting to ExecuTorch',  'API Reference', 'IR Specification', 'Compiler Entry Points', 'Runtime', 'Quantization', 'Kernel Library', 'Native Delegates', 'Backend Delegates', 'SDK', 'Tutorials']
</script>

 
<script type="text/javascript">
// Handle the right navigation in third level pages. Without this
// in third level, only the last item always selected. This is a hacky
// way and we should revise it eventually.
// #side-scroll-highlight is disabled in .css.
// Get all menu items
var menuItems = document.querySelectorAll('.pytorch-right-menu a.reference.internal');
// Add a click event listener to each menu item
for (var i = 0; i < menuItems.length; i++) {
  menuItems[i].addEventListener('click', function(event) {
    // Remove the 'side-scroll-highlight-local' class from all menu items
    for (var j = 0; j < menuItems.length; j++) {
      menuItems[j].classList.remove('side-scroll-highlight-local');
    }
    // Add the 'side-scroll-highlight-local' class to the clicked item
    event.target.classList.add('side-scroll-highlight-local');
  });
}
</script>

 
<script type="text/javascript">
  $(document).ready(function () {
    // Patch links on interactive tutorial pages to point
    // to the correct ExecuTorch URLs.
    var downloadNote = $(".sphx-glr-download-link-note.admonition.note");
    if (downloadNote.length >= 1) {
      var tutorialUrl = $("#tutorial-type").text().substring($("#tutorial-type").text().indexOf("tutorials/") + 9); // 9 is the length of "tutorials/"
      var githubLink = "https://github.com/pytorch/executorch/blob/main/docs/source/tutorials_source" + tutorialUrl + ".py",
        notebookLink = $(".reference.download")[1].href,
        notebookDownloadPath = notebookLink.split('_downloads')[1],
        colabLink = "https://colab.research.google.com/github/pytorch/executorch/blob/gh-pages/main/_downloads" + notebookDownloadPath;

      $(".pytorch-call-to-action-links a[data-response='Run in Google Colab']").attr("href", colabLink);
      $(".pytorch-call-to-action-links a[data-response='View on Github']").attr("href", githubLink);
    }

    // Patch the "GitHub" link at the top of the page
    // to point to the ExecuTorch repo.
    var overwrite = function (_) {
      if ($(this).length > 0) {
        $(this)[0].href = "https://github.com/pytorch/executorch"
      }
    }
    // PC
    $(".main-menu a:contains('GitHub')").each(overwrite);
    // Overwrite link to Tutorials and Get Started top navigation. If these sections are moved
    // this overrides need to be updated.
    $(".main-menu a:contains('Tutorials')").attr("href", "https://pytorch.org/executorch/main/index#tutorials-and-examples");
    $(".main-menu a:contains('Get Started')").attr("href", "https://pytorch.org/executorch/main/getting-started-setup");
    // Mobile
    $(".mobile-menu a:contains('Github')").each(overwrite);
    // Overwrite link to Tutorials and Get Started top navigation. If these sections are moved
    // this overrides need to be updated.
    $(".mobile-menu a:contains('Tutorials')").attr("href", "https://pytorch.org/executorch/main/index#tutorials-and-examples");
    $(".mobile-menu a:contains('Get Started')").attr("href", "https://pytorch.org/executorch/main/getting-started-setup");

  });
</script>


  <!-- Begin Footer -->

  <div class="container-fluid docs-tutorials-resources" id="docs-tutorials-resources">
    <div class="container">
      <div class="row">
        <div class="col-md-4 text-center">
          <h2>Docs</h2>
          <p>Access comprehensive developer documentation for PyTorch</p>
          <a class="with-right-arrow" href="https://pytorch.org/docs/stable/index.html">View Docs</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Tutorials</h2>
          <p>Get in-depth tutorials for beginners and advanced developers</p>
          <a class="with-right-arrow" href="https://pytorch.org/tutorials">View Tutorials</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Resources</h2>
          <p>Find development resources and get your questions answered</p>
          <a class="with-right-arrow" href="https://pytorch.org/resources">View Resources</a>
        </div>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container footer-container">
      <div class="footer-logo-wrapper">
        <a href="https://pytorch.org/" class="footer-logo"></a>
      </div>

      <div class="footer-links-wrapper">
        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/">PyTorch</a></li>
            <li><a href="https://pytorch.org/get-started">Get Started</a></li>
            <li><a href="https://pytorch.org/features">Features</a></li>
            <li><a href="https://pytorch.org/ecosystem">Ecosystem</a></li>
            <li><a href="https://pytorch.org/blog/">Blog</a></li>
            <li><a href="https://github.com/pytorch/pytorch/blob/master/CONTRIBUTING.md">Contributing</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/resources">Resources</a></li>
            <li><a href="https://pytorch.org/tutorials">Tutorials</a></li>
            <li><a href="https://pytorch.org/docs/stable/index.html">Docs</a></li>
            <li><a href="https://discuss.pytorch.org" target="_blank">Discuss</a></li>
            <li><a href="https://github.com/pytorch/pytorch/issues" target="_blank">Github Issues</a></li>
            <li><a href="https://pytorch.org/assets/brand-guidelines/PyTorch-Brand-Guidelines.pdf" target="_blank">Brand Guidelines</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title">Stay up to date</li>
            <li><a href="https://www.facebook.com/pytorch" target="_blank">Facebook</a></li>
            <li><a href="https://twitter.com/pytorch" target="_blank">Twitter</a></li>
            <li><a href="https://www.youtube.com/pytorch" target="_blank">YouTube</a></li>
            <li><a href="https://www.linkedin.com/company/pytorch" target="_blank">LinkedIn</a></li>
          </ul>  
          </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title">PyTorch Podcasts</li>
            <li><a href="https://open.spotify.com/show/6UzHKeiy368jKfQMKKvJY5" target="_blank">Spotify</a></li>
            <li><a href="https://podcasts.apple.com/us/podcast/pytorch-developer-podcast/id1566080008" target="_blank">Apple</a></li>
            <li><a href="https://www.google.com/podcasts?feed=aHR0cHM6Ly9mZWVkcy5zaW1wbGVjYXN0LmNvbS9PQjVGa0lsOA%3D%3D" target="_blank">Google</a></li>
            <li><a href="https://music.amazon.com/podcasts/7a4e6f0e-26c2-49e9-a478-41bd244197d0/PyTorch-Developer-Podcast?" target="_blank">Amazon</a></li>
          </ul>
         </div>
        </div>
        
        <div class="privacy-policy">
          <ul>
            <li class="privacy-policy-links"><a href="https://www.linuxfoundation.org/terms/" target="_blank">Terms</a></li>
            <li class="privacy-policy-links">|</li>
            <li class="privacy-policy-links"><a href="https://www.linuxfoundation.org/privacy-policy/" target="_blank">Privacy</a></li>
          </ul>
        </div>
        <div class="copyright">
        <p>© Copyright The Linux Foundation. The PyTorch Foundation is a project of The Linux Foundation.
          For web site terms of use, trademark policy and other policies applicable to The PyTorch Foundation please see
          <a href="https://www.linuxfoundation.org/policies/">www.linuxfoundation.org/policies/</a>. The PyTorch Foundation supports the PyTorch open source
          project, which has been established as PyTorch Project a Series of LF Projects, LLC. For policies applicable to the PyTorch Project a Series of LF Projects, LLC,
          please see <a href="https://www.lfprojects.org/policies/">www.lfprojects.org/policies/</a>.</p>
      </div>
     </div>

  </footer>

  <div class="cookie-banner-wrapper">
  <div class="container">
    <p class="gdpr-notice">To analyze traffic and optimize your experience, we serve cookies on this site. By clicking or navigating, you agree to allow our usage of cookies. As the current maintainers of this site, Facebook’s Cookies Policy applies. Learn more, including about available controls: <a href="https://www.facebook.com/policies/cookies/">Cookies Policy</a>.</p>
    <img class="close-button" src="../../../../_static/images/pytorch-x.svg">
  </div>
</div>

  <!-- End Footer -->

  <!-- Begin Mobile Menu -->

  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>

    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
           <li class="resources-mobile-menu-title">
             <a>Learn</a>
           </li>
           <ul class="resources-mobile-menu-items">
             <li>
               <a href="https://pytorch.org/get-started">Get Started</a>
             </li>
             <li>
               <a href="https://pytorch.org/tutorials">Tutorials</a>
             </li>
             <li>
               <a href="https://pytorch.org/tutorials/beginner/basics/intro.html">Learn the Basics</a>
             </li>
             <li>
               <a href="https://pytorch.org/tutorials/recipes/recipes_index.html">PyTorch Recipes</a>
             </li>
             <li>
               <a href="https://pytorch.org/tutorials/beginner/introyt.html">Introduction to PyTorch - YouTube Series</a>
             </li>
           </ul>
           <li class="resources-mobile-menu-title">
             <a>Ecosystem</a>
           </li>
           <ul class="resources-mobile-menu-items">
             <li>
               <a href="https://pytorch.org/ecosystem">Tools</a>
             </li>
             <li>
               <a href="https://pytorch.org/#community-module">Community</a>
             </li>
             <li>
               <a href="https://discuss.pytorch.org/">Forums</a>
             </li>
             <li>
               <a href="https://pytorch.org/resources">Developer Resources</a>
             </li>
             <li>
               <a href="https://pytorch.org/ecosystem/contributor-awards-2023">Contributor Awards - 2024</a>
             </li>
           </ul>

           <li class="resources-mobile-menu-title">
             <a>Edge</a>
           </li>

           <ul class="resources-mobile-menu-items">
             <li>
               <a href="https://pytorch.org/edge">About PyTorch Edge</a>
             </li>
             
             <li>
               <a href="https://pytorch.org/executorch-overview">ExecuTorch</a>
             </li>
             <li>
               <a href="https://pytorch.org/executorch/stable/index.html">ExecuTorch Documentation</a>
             </li>
           </ul>

           <li class="resources-mobile-menu-title">
             <a>Docs</a>
           </li>

           <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/docs/stable/index.html">PyTorch</a>
            </li>

            <li>
              <a href="https://pytorch.org/pytorch-domains">PyTorch Domains</a>
            </li>
          </ul>

          <li class="resources-mobile-menu-title">
            <a>Blog & News</a>
          </li>
            
           <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/blog/">PyTorch Blog</a>
            </li>
            <li>
              <a href="https://pytorch.org/community-blog">Community Blog</a>
            </li>

            <li>
              <a href="https://pytorch.org/videos">Videos</a>
            </li>

            <li>
              <a href="https://pytorch.org/community-stories">Community Stories</a>
            </li>
            <li>
              <a href="https://pytorch.org/events">Events</a>
            </li>
            <li>
               <a href="https://pytorch.org/newsletter">Newsletter</a>
             </li>
          </ul>
          
          <li class="resources-mobile-menu-title">
            <a>About</a>
          </li>

          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/foundation">PyTorch Foundation</a>
            </li>
            <li>
              <a href="https://pytorch.org/governing-board">Governing Board</a>
            </li>
            <li>
               <a href="https://pytorch.org/credits">Cloud Credit Program</a>
            </li>
            <li>
               <a href="https://pytorch.org/tac">Technical Advisory Council</a>
            </li>
            <li>
               <a href="https://pytorch.org/staff">Staff</a>
            </li>
            <li>
               <a href="https://pytorch.org/contact-us">Contact Us</a>
            </li>
          </ul>
        </ul>
      </div>
    </div>
  </div>

  <!-- End Mobile Menu -->

  <script type="text/javascript" src="../../../../_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    $(document).ready(function() {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();
      mainMenuDropdown.bind();
      filterTags.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function(e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>
</body>
</html>